---
description: "从想法到生产代码的自动化多代理开发工作流，带质量门控"
allowed-tools: ["Task", "Read", "Write", "Edit", "MultiEdit", "Grep", "Glob", "TodoWrite"]
---

# Agent Workflow - 自动化开发流水线

使用智能子代理链和质量门控执行完整的开发工作流。

## 用法

```bash
/agent-workflow <功能描述>
```

## 上下文

- 要开发的功能：$ARGUMENTS
- 带质量门控的自动化多代理工作流
- 子代理在独立上下文中工作，具有智能链式连接

## 你的角色

你是工作流协调器，管理使用 Claude Code 子代理的自动化开发流水线。你协调一个带质量门控的工作流，通过智能循环确保 95%+ 的代码质量。

## 子代理链流程

使用 Claude Code 的子代理语法执行以下链：

```
首先使用 spec-analyst 子代理为 [$ARGUMENTS] 生成完整规范，然后使用 spec-architect 子代理设计系统架构，然后使用 spec-developer 子代理基于规范实施代码，然后使用 spec-validator 子代理评估代码质量并评分，然后如果分数 ≥95% 使用 spec-tester 子代理生成全面测试套件，否则首先再次使用 spec-analyst 子代理基于验证反馈改进规范并重复该链。
```

## 工作流逻辑

### 质量门控机制

- **验证分数 ≥95%**：继续到 spec-tester 子代理
- **验证分数 <95%**：循环回到 spec-analyst 子代理并附带反馈
- **最多 3 次迭代**：防止无限循环

### 链执行步骤

1. **spec-analyst 子代理**：生成 requirements.md、user-stories.md、acceptance-criteria.md
2. **spec-architect 子代理**：创建 architecture.md、api-spec.md、tech-stack.md
3. **spec-developer 子代理**：基于规范实施代码
4. **spec-validator 子代理**：多维质量评分（0-100%）
5. **质量门控决策**：
   - 如果 ≥95%：继续到 spec-tester 子代理
   - 如果 <95%：返回 spec-analyst 子代理并附带具体反馈
6. **spec-tester 子代理**：生成全面测试套件（最后一步）

## 预期迭代

- **第 1 轮**：初始实施（通常 80-90% 质量）
- **第 2 轮**：解决反馈的改进实施（通常 90-95%）
- **第 3 轮**：如需要，最终优化（目标 95%+）

## 输出格式

1. **工作流启动** - 使用功能描述启动子代理链
2. **进度跟踪** - 监控每个子代理的完成情况
3. **质量门控决策** - 报告审查分数和下一步操作
4. **完成摘要** - 最终工件和质量指标

## 关键优势

- **自动化质量控制**：95% 阈值确保高标准
- **智能反馈循环**：审查反馈指导规范改进
- **独立上下文**：每个子代理在干净环境中工作
- **一键执行**：单个命令触发整个工作流

---

## 执行工作流

**功能描述**：$ARGUMENTS

正在启动带质量门控的自动化开发工作流...

### 🎯 阶段 1：规范生成

首先使用 **spec-analyst** 子代理分析需求并生成：

- 详细的需求文档
- 带验收标准的用户故事
- 技术约束和假设
- 成功指标和验证标准

### 🏗️ 阶段 2：架构设计

然后使用 **spec-architect** 子代理创建：

- 系统架构设计
- API 规范和合约
- 技术栈决策
- 数据库模式和数据流
- 安全和性能考虑

### 💻 阶段 3：实施

然后使用 **spec-developer** 子代理：

- 基于规范实施核心功能
- 遵循最佳实践和编码标准
- 创建模块化、可维护的代码结构
- 包含基本错误处理和日志记录

### ✅ 阶段 4：质量验证

然后使用 **spec-validator** 子代理评估：

- 代码质量指标（可读性、可维护性）
- 架构合规性和最佳实践
- 安全漏洞和性能问题
- 文档完整性和准确性
- **提供质量分数（0-100%）**

### 🔄 质量门控决策

**如果验证分数 ≥95%**：进入测试阶段 **如果验证分数 <95%**：循环回到 spec-analyst 并附带改进反馈

### 🧪 阶段 5：测试生成（最后）

最后使用 **spec-tester** 子代理创建：

- 全面的单元测试套件
- 关键工作流的集成测试
- 端到端测试场景
- 性能和负载测试脚本
- 测试覆盖率报告和质量指标

## 预期输出结构

```
project/
├── docs/
│   ├── requirements.md
│   ├── architecture.md
│   ├── api-spec.md
│   └── user-stories.md
├── src/
│   ├── components/
│   ├── services/
│   ├── utils/
│   └── types/
├── tests/
│   ├── unit/
│   ├── integration/
│   └── e2e/
├── package.json
└── README.md
```

**现在开始使用提供的功能描述执行，并在每个子代理完成后报告进度。**
