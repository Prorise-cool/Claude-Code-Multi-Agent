# 自动标签 - 根据内容自动标记问题和 PR
name: 自动标签

on:
  issues:
    types: [opened, edited]
  pull_request:
    types: [opened, edited]

permissions:
  issues: write
  pull-requests: write

jobs:
  label-issues:
    name: 标记问题
    runs-on: ubuntu-latest
    if: github.event_name == 'issues'
    steps:
      - name: 标记 Bug 报告
        if: contains(github.event.issue.title, '[Bug]')
        uses: actions/github-script@v8
        with:
          script: |
            github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['bug']
            })

      - name: 标记功能请求
        if: contains(github.event.issue.title, '[Feature]')
        uses: actions/github-script@v8
        with:
          script: |
            github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['enhancement']
            })

      - name: 标记技能请求
        if: contains(github.event.issue.title, '[Skill]')
        uses: actions/github-script@v8
        with:
          script: |
            github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['skill-request', 'enhancement']
            })

      - name: 标记问题
        if: contains(github.event.issue.title, '[Question]')
        uses: actions/github-script@v8
        with:
          script: |
            github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['question']
            })

  label-prs:
    name: 标记拉取请求
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    steps:
      - name: 检出仓库
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 获取更改的文件
        id: changed-files
        uses: tj-actions/changed-files@v44

      - name: 标记文档更改
        if: contains(steps.changed-files.outputs.all_changed_files, '.md') || contains(steps.changed-files.outputs.all_changed_files, 'docs/')
        uses: actions/github-script@v8
        with:
          script: |
            github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['documentation']
            })

      - name: 标记 Hook 更改
        if: contains(steps.changed-files.outputs.all_changed_files, '.claude/hooks/')
        uses: actions/github-script@v8
        with:
          script: |
            github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['hooks']
            })

      - name: 标记技能更改
        if: contains(steps.changed-files.outputs.all_changed_files, '.claude/skills/')
        uses: actions/github-script@v8
        with:
          script: |
            github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['skills']
            })

      - name: 标记命令更改
        if: contains(steps.changed-files.outputs.all_changed_files, '.claude/commands/')
        uses: actions/github-script@v8
        with:
          script: |
            github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['commands']
            })

      - name: 标记 CI/CD 更改
        if: contains(steps.changed-files.outputs.all_changed_files, '.github/workflows/')
        uses: actions/github-script@v8
        with:
          script: |
            github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['ci/cd']
            })
