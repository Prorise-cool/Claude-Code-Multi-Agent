# æ¬¢è¿ - é—®å€™é¦–æ¬¡è´¡çŒ®è€…
name: æ¬¢è¿æ–°è´¡çŒ®è€…

on:
  issues:
    types: [opened]
  pull_request_target:
    types: [opened]

permissions:
  issues: write
  pull-requests: write

jobs:
  welcome-issue:
    name: æ¬¢è¿é—®é¢˜ä½œè€…
    runs-on: ubuntu-latest
    if: github.event_name == 'issues'
    steps:
      - name: æ£€æŸ¥æ˜¯å¦ä¸ºé¦–æ¬¡é—®é¢˜
        id: check
        uses: actions/github-script@v7
        with:
          script: |
            const creator = context.payload.issue.user.login;
            const { data: issues } = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              creator: creator,
              state: 'all'
            });
            return issues.length === 1;
          result-encoding: string

      - name: æ¬¢è¿é¦–æ¬¡é—®é¢˜ä½œè€…
        if: steps.check.outputs.result == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            const issueNumber = context.payload.issue.number;
            const creator = context.payload.issue.user.login;

            const message = `ğŸ‘‹ æ¬¢è¿ @${creator}ï¼æ„Ÿè°¢æ‚¨åœ¨ Claude Code Multi-Agent ä¸­å¼€å¯æ‚¨çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼

            æˆ‘ä»¬æ„Ÿè°¢æ‚¨èŠ±æ—¶é—´æŠ¥å‘Šè¿™ä¸ªé—®é¢˜ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æç¤ºï¼š

            - ç¡®ä¿æ‚¨å·²åœ¨é—®é¢˜æ¨¡æ¿ä¸­æä¾›äº†æ‰€æœ‰è¯·æ±‚çš„ä¿¡æ¯
            - æŸ¥çœ‹[æ–‡æ¡£](https://github.com/Prorise-cool/Claude-Code-Multi-Agent/tree/master/project_document)ä»¥è·å–ç­”æ¡ˆ
            - åŠ å…¥æˆ‘ä»¬çš„[è®¨è®º](https://github.com/Prorise-cool/Claude-Code-Multi-Agent/discussions)æé—®

            ç»´æŠ¤è€…å°†å¾ˆå¿«å®¡æŸ¥æ‚¨çš„é—®é¢˜ã€‚æ„Ÿè°¢æ‚¨çš„è´¡çŒ®ï¼ğŸ‰`;

            github.rest.issues.createComment({
              issue_number: issueNumber,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: message
            });

  welcome-pr:
    name: æ¬¢è¿ PR ä½œè€…
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request_target'
    steps:
      - name: æ£€æŸ¥æ˜¯å¦ä¸ºé¦–æ¬¡ PR
        id: check
        uses: actions/github-script@v7
        with:
          script: |
            const creator = context.payload.pull_request.user.login;
            const { data: prs } = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'all'
            });
            const userPrs = prs.filter(pr => pr.user.login === creator);
            return userPrs.length === 1;
          result-encoding: string

      - name: æ¬¢è¿é¦–æ¬¡ PR ä½œè€…
        if: steps.check.outputs.result == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            const prNumber = context.payload.pull_request.number;
            const creator = context.payload.pull_request.user.login;

            const message = `ğŸ‰ æ¬¢è¿ @${creator}ï¼æ„Ÿè°¢æ‚¨å¯¹ Claude Code Multi-Agent çš„é¦–æ¬¡æ‹‰å–è¯·æ±‚ï¼

            æˆ‘ä»¬å¾ˆé«˜å…´æ‚¨èƒ½åšå‡ºè´¡çŒ®ã€‚æ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼š

            1. **è‡ªåŠ¨åŒ–æ£€æŸ¥**å°†åœ¨æ‚¨çš„ PR ä¸Šè¿è¡Œ
            2. **ç»´æŠ¤è€…å°†å®¡æŸ¥**æ‚¨çš„æ›´æ”¹
            3. æ‚¨å¯èƒ½ä¼šæ”¶åˆ°**åé¦ˆæˆ–æ›´æ”¹è¯·æ±‚**
            4. ä¸€æ—¦è·å¾—æ‰¹å‡†ï¼Œæ‚¨çš„ PR å°†è¢«**åˆå¹¶**

            åœ¨ç­‰å¾…æœŸé—´ï¼Œè¯·ç¡®ä¿ï¼š
            - [ ] æ‚¨çš„ PR éµå¾ªæˆ‘ä»¬çš„[è´¡çŒ®æŒ‡å—](https://github.com/Prorise-cool/Claude-Code-Multi-Agent/blob/master/.github/CONTRIBUTING.md)
            - [ ] æ‰€æœ‰è‡ªåŠ¨åŒ–æ£€æŸ¥éƒ½é€šè¿‡
            - [ ] æ‚¨å·²å®Œæ•´å¡«å†™äº† PR æ¨¡æ¿

            æ„Ÿè°¢æ‚¨å¸®åŠ©ä½¿ Claude Code Multi-Agent å˜å¾—æ›´å¥½ï¼ğŸš€`;

            github.rest.issues.createComment({
              issue_number: prNumber,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: message
            });
